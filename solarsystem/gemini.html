<!DOCTYPE html>
<html lang="en">
	<head>
		<title>3D Solar System</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<style>
			body {
				margin: 0;
				overflow: hidden; /* Hide scrollbars */
				font-family: Arial, sans-serif;
				background-color: #000;
			}
			#info {
				position: absolute;
				top: 10px;
				width: 100%;
				text-align: center;
				color: white;
				z-index: 100;
				display: block;
			}
            #info h1 {
                margin: 0;
                font-size: 1.5em;
            }
            #info p {
                margin: 5px;
                font-size: 0.9em;
            }
		</style>
	</head>
	<body>
        <!-- Info display -->
        <div id="info">
            <h1>3D Solar System</h1>
            <p>Controls: Left-drag (Orbit), Scroll (Zoom), Right-drag (Pan)</p>
        </div>

		<!-- Main 3D canvas -->
		<script type="module">
			// --- Imports ---
			import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js';
			import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/controls/OrbitControls.js';

			// --- Core Components ---
			let scene, camera, renderer, controls;
            let sunMesh;
            const planetPivots = []; // To store pivots for animation

			function init() {
				// 1. Scene
				scene = new THREE.Scene();

				// 2. Camera
				camera = new THREE.PerspectiveCamera(
					75, // Field of View
					window.innerWidth / window.innerHeight, // Aspect Ratio
					0.1, // Near clip
					1000 // Far clip
				);
				camera.position.z = 30;
                camera.position.y = 5;

				// 3. Renderer
				renderer = new THREE.WebGLRenderer({ antialias: true });
				renderer.setSize(window.innerWidth, window.innerHeight);
				document.body.appendChild(renderer.domElement);

				// 4. Controls
                // We add this now, as per checklist item 7
				controls = new OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true; // For smoother motion
                controls.dampingFactor = 0.05;

				// --- Lighting ---
				const ambientLight = new THREE.AmbientLight(0x404040, 0.5); // Soft global light
				scene.add(ambientLight);

				const pointLight = new THREE.PointLight(0xFFFFFF, 3, 0); // Sun's light
				scene.add(pointLight);

				// --- Create Bodies (Milestone 2 & 3) ---

                // 1. Create Sun
				const sunGeo = new THREE.SphereGeometry(2.5, 32, 32);
				const sunMat = new THREE.MeshBasicMaterial({ color: 0xFFFF00, map: createGlowTexture() });
				sunMesh = new THREE.Mesh(sunGeo, sunMat);
				scene.add(sunMesh);

                // 2. Define Planet Data
                const planetData = [
                    { name: 'Mercury', size: 0.38, color: 0x8c8c8c, orbitRadius: 5, speed: 0.02 },
                    { name: 'Venus', size: 0.95, color: 0xeda14a, orbitRadius: 8, speed: 0.012 },
                    { name: 'Earth', size: 1.0, color: 0x3b82f6, orbitRadius: 12, speed: 0.01 },
                    { name: 'Mars', size: 0.53, color: 0xb95a3c, orbitRadius: 16, speed: 0.008 },
                    { name: 'Jupiter', size: 3.5, color: 0xe0c6a7, orbitRadius: 22, speed: 0.004 },
                    { name: 'Saturn', size: 3.0, color: 0xf0d9a6, orbitRadius: 28, speed: 0.003, hasRing: true },
                ];

                // 3. Create Planets, Pivots, and Orbits (Milestone 4 & 5)
                planetData.forEach(planet => {
                    // Create the planet mesh
                    const planetGeo = new THREE.SphereGeometry(planet.size, 32, 32);
                    const planetMat = new THREE.MeshStandardMaterial({ 
                        color: planet.color,
                        roughness: 0.7 
                    });
                    const planetMesh = new THREE.Mesh(planetGeo, planetMat);
                    planetMesh.position.x = planet.orbitRadius; // Offset from pivot

                    // Create the pivot
                    const planetPivot = new THREE.Object3D();
                    planetPivot.add(planetMesh); // Add planet to pivot

                    // Store user data for animation
                    planetPivot.userData = { 
                        speed: planet.speed, // Orbit speed
                        selfSpeed: 0.05,     // Self-rotation speed
                        mesh: planetMesh 
                    }; 

                    // Add Saturn's ring
                    if (planet.hasRing) {
                        const ringGeo = new THREE.RingGeometry(planet.size * 1.2, planet.size * 1.8, 32);
                        const ringMat = new THREE.MeshBasicMaterial({ 
                            color: 0xcccccc, 
                            side: THREE.DoubleSide,
                            transparent: true,
                            opacity: 0.6
                        });
                        const ringMesh = new THREE.Mesh(ringGeo, ringMat);
                        ringMesh.rotation.x = Math.PI / 2.5; // Tilt the ring
                        planetMesh.add(ringMesh); // Add ring to the planet itself
                    }

                    // Create the orbit path
                    const orbitGeo = new THREE.RingGeometry(planet.orbitRadius - 0.05, planet.orbitRadius + 0.05, 128);
                    const orbitMat = new THREE.MeshBasicMaterial({ 
                        color: 0xFFFFFF, 
                        side: THREE.DoubleSide,
                        transparent: true,
                        opacity: 0.2
                    });
                    const orbitMesh = new THREE.Mesh(orbitGeo, orbitMat);
                    orbitMesh.rotation.x = Math.PI / 2; // Rotate ring to be flat
                    
                    // Add pivot and orbit ring to the scene
                    scene.add(planetPivot);
                    scene.add(orbitMesh);
                    
                    // Save pivot for animation
                    planetPivots.push(planetPivot);
                });

				// --- Event Listeners ---
				window.addEventListener('resize', onWindowResize, false);
			}

            // Helper function to create a radial gradient texture for the sun's glow
            function createGlowTexture() {
                const canvas = document.createElement('canvas');
                canvas.width = 128;
                canvas.height = 128;
                const context = canvas.getContext('2d');
                const gradient = context.createRadialGradient(
                    canvas.width / 2, canvas.height / 2, 0,
                    canvas.width / 2, canvas.height / 2, canvas.width / 2
                );
                gradient.addColorStop(0.1, 'rgba(255, 255, 200, 1)');
                gradient.addColorStop(0.5, 'rgba(255, 200, 0, 0.5)');
                gradient.addColorStop(1, 'rgba(255, 165, 0, 0)');
                
                context.fillStyle = gradient;
                context.fillRect(0, 0, canvas.width, canvas.height);
                
                return new THREE.CanvasTexture(canvas);
            }

			// --- Resize Handler ---
			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize(window.innerWidth, window.innerHeight);
			}

			// --- Animation Loop (Milestone 6) ---
			function animate() {
				requestAnimationFrame(animate);

                // Animate Sun
                sunMesh.rotation.y += 0.001;

                // Animate Planets
                planetPivots.forEach(pivot => {
                    // 1. Orbit (rotate the pivot)
                    pivot.rotation.y += pivot.userData.speed;

                    // 2. Self-rotation (rotate the mesh itself)
                    pivot.userData.mesh.rotation.y += pivot.userData.selfSpeed;
                });

                // Update controls
				controls.update();

				// Render the scene
				renderer.render(scene, camera);
			}

			// --- Run ---
			init();
			animate();
		</script>
	</body>
</html>