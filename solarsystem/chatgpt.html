<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¤ªé™½ç³»æ¨¡æ“¬å™¨ï½œå–®ä¸€ HTML æª”</title>
  <style>
    :root{
      --panel-bg: rgba(20,22,28,0.66);
      --panel-border: rgba(255,255,255,0.12);
      --accent: #8bd3ff;
      --text: #e8eef6;
      --muted: #a9b3c3;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font: 15px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, 'PingFang TC', 'Heiti TC', sans-serif;
      /* å¤ªç©ºæ¼¸å±¤èƒŒæ™¯ */
      background: radial-gradient(1200px 800px at 70% 30%, #0b1530 0%, #040914 60%, #000 100%);
      overflow:hidden;
    }
    /* ç•«å¸ƒé‹ªæ»¿è¦–çª—ï¼Œä½¿ç”¨é«˜ DPI å¯«æ³•åœ¨ JS æ§ */
    canvas#universe{position:fixed; inset:0; display:block;}

    /* æ§åˆ¶é¢æ¿ */
    .panel{
      position: fixed; left: 16px; top: 16px; width: min(380px, 92vw);
      backdrop-filter: blur(8px) saturate(1.2);
      background: var(--panel-bg);
      border: 1px solid var(--panel-border);
      border-radius: 16px; padding: 14px 14px 10px; box-shadow: 0 6px 30px rgba(0,0,0,0.35);
    }
    .panel h1{margin:0 0 8px; font-size:18px; letter-spacing:.3px}
    .row{display:grid; grid-template-columns: 1fr auto; align-items:center; gap:10px; margin:8px 0}
    .row > label{color:var(--muted)}
    .row span.value{min-width:70px; text-align:right; color:var(--text); font-variant-numeric: tabular-nums}
    .grid{
      display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:8px; margin-top:8px
    }
    .btn{cursor:pointer; user-select:none; border-radius:12px; padding:8px 12px; border:1px solid var(--panel-border);
      background:#0e1624; color:#e9f3ff; transition: .15s transform, .15s background;
    }
    .btn:hover{background:#16243a}
    .btn:active{transform:translateY(1px)}
    .btn.wide{grid-column: span 2}

    input[type="range"]{width: 100%}
    input[type="range"]{accent-color: var(--accent)}
    input[type="checkbox"]{width:18px; height:18px; accent-color: var(--accent); vertical-align: middle}
    .toggle{display:flex; align-items:center; gap:10px}

    details{margin-top:6px; border-top:1px dashed var(--panel-border); padding-top:8px}
    details summary{cursor:pointer; color:var(--muted)}
    details p{margin:6px 0 0; color:#cbd6e7}

    /* å³ä¸‹è§’è³‡è¨Šæ¢ */
    .infobar{
      position: fixed; right: 16px; bottom: 12px; padding:8px 12px; border-radius: 12px;
      background: var(--panel-bg); border:1px solid var(--panel-border); backdrop-filter: blur(6px);
      color:#cfe5ff; font-variant-numeric: tabular-nums; box-shadow: 0 6px 24px rgba(0,0,0,0.3)
    }

    /* è¡Œæ˜Ÿ hover æç¤º */
    .tooltip{
      position: fixed; pointer-events:none; transform: translate(-50%, calc(-100% - 10px));
      background: rgba(0,0,0,0.72); border:1px solid rgba(255,255,255,0.14); border-radius:10px; padding:6px 8px; font-size:13px;
      white-space:nowrap; color:#fff; box-shadow:0 6px 20px rgba(0,0,0,0.45); display:none
    }

    @media (max-width: 768px){
      .panel{left: 10px; right: 10px; width:auto}
      .grid{grid-template-columns: 1fr 1fr}
    }
  </style>
</head>
<body>
  <canvas id="universe" role="img" aria-label="å¤ªé™½ç³» 2D æ¨¡æ“¬"></canvas>

  <div class="panel" aria-live="polite">
    <h1>å¤ªé™½ç³»æ¨¡æ“¬å™¨ï¼ˆå–®ä¸€ HTMLï¼‰</h1>

    <div class="row">
      <label for="speed">æ¨¡æ“¬é€Ÿåº¦ï¼ˆå¤©/ç§’ï¼‰</label>
      <span class="value" id="speedVal">â€”</span>
    </div>
    <input id="speed" type="range" min="0" max="1000" step="1" value="80" />

    <div class="row">
      <label for="dist">è·é›¢ç¸®æ”¾ï¼ˆpx / AUï¼‰</label>
      <span class="value" id="distVal">â€”</span>
    </div>
    <input id="dist" type="range" min="4" max="60" step="1" value="28" />

    <div class="row">
      <label for="size">è¡Œæ˜Ÿå°ºå¯¸å€ç‡</label>
      <span class="value" id="sizeVal">â€”</span>
    </div>
    <input id="size" type="range" min="0.4" max="6" step="0.1" value="1.6" />

    <div class="grid">
      <label class="toggle"><input id="showOrbits" type="checkbox" checked/>é¡¯ç¤ºè»Œé“</label>
      <label class="toggle"><input id="showLabels" type="checkbox" checked/>é¡¯ç¤ºæ¨™ç±¤</label>
      <label class="toggle"><input id="showTrails" type="checkbox"/>é¡¯ç¤ºå°¾è·¡</label>
      <label class="toggle"><input id="includePluto" type="checkbox"/>åŒ…å«å†¥ç‹æ˜Ÿ</label>
      <button id="playPause" class="btn">â¸ æš«åœ</button>
      <button id="reset" class="btn">ğŸ”„ é‡è¨­</button>
      <button id="centerSun" class="btn wide">â˜€ï¸ ä»¥å¤ªé™½ç‚ºä¸­å¿ƒ</button>
    </div>

    <details>
      <summary>ä½¿ç”¨èªªæ˜èˆ‡æ³¨æ„äº‹é …</summary>
      <p>æ­¤æ¨¡æ“¬ä»¥ <strong>åœ“å½¢è»Œé“</strong> è¿‘ä¼¼çœŸå¯¦é‹å‹•ï¼Œé€±æœŸèˆ‡æ—¥æ•¸æ¯”ä¾‹æ¥è¿‘å¯¦éš›å€¼ï¼›è·é›¢èˆ‡è¡Œæ˜Ÿå°ºå¯¸çš†ç¶“éè¦–è¦ºåŒ–ç¸®æ”¾ï¼ŒéçœŸå¯¦æ¯”ä¾‹ã€‚</p>
      <p>æ‹–æ›³ç©ºç™½è™•å¯å¹³ç§»è¦–è§’ï¼Œä½¿ç”¨æ»¾è¼ªå¯ç¸®æ”¾ï¼ˆåƒ…è·é›¢ç¸®æ”¾ï¼‰ã€‚</p>
    </details>
  </div>

  <div class="infobar" id="infobar">â€”</div>
  <div class="tooltip" id="tooltip"></div>

<script>
(() => {
  'use strict';
  // === å¸¸æ•¸èˆ‡è³‡æ–™ ===
  const AU = 1; // æˆ‘å€‘ä»¥ AU ç‚ºå–®ä½ï¼Œè½‰åƒç´ æ™‚ä¹˜ä»¥ pxPerAU
  const TWOPI = Math.PI * 2;
  const BASE_DATE = new Date('2000-01-01T00:00:00Z'); // æ¨¡æ“¬èµ·å§‹åƒè€ƒæ—¥æœŸ

  const PLANETS_ALL = [
    { key:'mercury', name:'æ°´æ˜Ÿ', color:'#b9b9b9', au:0.387, period:87.969, radiusRel:0.383, info:'æœ€å…§å´è¡Œæ˜Ÿ' },
    { key:'venus',   name:'é‡‘æ˜Ÿ', color:'#e6d190', au:0.723, period:224.701, radiusRel:0.949 },
    { key:'earth',   name:'åœ°çƒ', color:'#4da6ff', au:1.000, period:365.256, radiusRel:1.000 },
    { key:'mars',    name:'ç«æ˜Ÿ', color:'#ff6b4d', au:1.524, period:686.980, radiusRel:0.532 },
    { key:'jupiter', name:'æœ¨æ˜Ÿ', color:'#d9b38c', au:5.203, period:4332.589, radiusRel:11.21 },
    { key:'saturn',  name:'åœŸæ˜Ÿ', color:'#e6c97e', au:9.537, period:10759.22, radiusRel:9.45, ring:true },
    { key:'uranus',  name:'å¤©ç‹æ˜Ÿ', color:'#94d6d6', au:19.191, period:30685.4, radiusRel:4.01 },
    { key:'neptune', name:'æµ·ç‹æ˜Ÿ', color:'#5b8cff', au:30.068, period:60190, radiusRel:3.88 },
    { key:'pluto',   name:'å†¥ç‹æ˜Ÿ', color:'#cccccc', au:39.482, period:90560, radiusRel:0.186, dwarf:true },
  ];

  // === DOM åƒç…§ ===
  const canvas = document.getElementById('universe');
  const ctx = canvas.getContext('2d');
  const panel = document.querySelector('.panel');
  const speedEl = document.getElementById('speed');
  const speedVal = document.getElementById('speedVal');
  const distEl  = document.getElementById('dist');
  const distVal = document.getElementById('distVal');
  const sizeEl  = document.getElementById('size');
  const sizeVal = document.getElementById('sizeVal');
  const showOrbitsEl = document.getElementById('showOrbits');
  const showLabelsEl = document.getElementById('showLabels');
  const showTrailsEl = document.getElementById('showTrails');
  const includePlutoEl = document.getElementById('includePluto');
  const playPauseBtn = document.getElementById('playPause');
  const resetBtn = document.getElementById('reset');
  const centerSunBtn = document.getElementById('centerSun');
  const infobar = document.getElementById('infobar');
  const tooltip = document.getElementById('tooltip');

  // === ç•«å¸ƒèˆ‡åº§æ¨™ ===
  let dpr = Math.max(1, window.devicePixelRatio || 1);
  let width = 0, height = 0;
  let centerX = 0, centerY = 0; // è¦–åœ–ä¸­å¿ƒï¼ˆå¯å¹³ç§»ï¼‰
  let viewOffsetX = 0, viewOffsetY = 0; // ä½¿ç”¨è€…æ‹–æ›³ç”¢ç”Ÿçš„åç§»ï¼ˆpxï¼‰

  // === æ¨¡æ“¬ç‹€æ…‹ ===
  let running = true;
  let simDays = 0; // å¾ BASE_DATE èµ·ç®—çš„æ¨¡æ“¬æ—¥æ•¸
  let daysPerSecond = parseFloat(speedEl.value); // å¤©/ç§’
  let pxPerAU = parseFloat(distEl.value); // åƒç´ /å¤©æ–‡å–®ä½
  let sizeScale = parseFloat(sizeEl.value); // è¡Œæ˜Ÿå°ºå¯¸å€ç‡

  // æ»‘é¼ äº’å‹•
  let mouseX = 0, mouseY = 0, isDragging = false, dragStartX = 0, dragStartY = 0, dragViewX = 0, dragViewY = 0;

  // æ˜Ÿé‡ï¼ˆèƒŒæ™¯æ˜Ÿç©ºï¼‰ä½¿ç”¨é›¢å±ç•«å¸ƒæå‡æ•ˆç‡
  const starLayer = document.createElement('canvas');
  const starCtx = starLayer.getContext('2d');

  function buildStars(){
    const S = 1000; // åŸºåº•åœ–å°ºå¯¸ï¼Œä¹‹å¾Œå¹³é‹ªç¸®æ”¾
    starLayer.width = S; starLayer.height = S;
    const grad = starCtx.createRadialGradient(S*0.5,S*0.5,0,S*0.5,S*0.5,S*0.9);
    grad.addColorStop(0,'#020411');
    grad.addColorStop(1,'#000');
    starCtx.fillStyle = grad; starCtx.fillRect(0,0,S,S);
    const count = 800;
    for(let i=0;i<count;i++){
      const x = Math.random()*S, y = Math.random()*S;
      const r = Math.random()*1.2 + 0.2;
      const a = 0.6 + Math.random()*0.4;
      starCtx.fillStyle = `rgba(255,255,255,${a.toFixed(2)})`;
      starCtx.beginPath(); starCtx.arc(x,y,r,0,TWOPI); starCtx.fill();
      // å¾®è—/å¾®é»ƒçš„æ˜Ÿè‰²
      if (Math.random()<0.2){
        starCtx.fillStyle = Math.random()<0.5 ? 'rgba(160,200,255,0.5)' : 'rgba(255,230,180,0.5)';
        starCtx.beginPath(); starCtx.arc(x+0.5,y+0.5,r*0.9,0,TWOPI); starCtx.fill();
      }
    }
  }

  function resize(){
    dpr = Math.max(1, window.devicePixelRatio || 1);
    width = Math.floor(window.innerWidth * dpr);
    height= Math.floor(window.innerHeight* dpr);
    canvas.width = width; canvas.height = height;
    canvas.style.width = Math.floor(width/dpr)+'px';
    canvas.style.height= Math.floor(height/dpr)+'px';
    centerX = width/2; centerY = height/2;
  }

  function fitPxPerAU(){
    // è®“æµ·ç‹æ˜Ÿæ¥è¿‘ç•«é¢é‚Šç·£ï¼Œä¿ç•™ç•™ç™½
    const includePluto = includePlutoEl.checked;
    const maxAU = includePluto ? 39.482 : 30.068;
    const minEdge = Math.min(width, height);
    // 0.43 ä¿‚æ•¸ç‚ºç¾è§€ç•™ç™½ï¼Œçµæœæ›ç®—è‡³ CSS åƒç´ 
    const fit = (minEdge * 0.43) / maxAU;
    // å°‡ dist range çš„é è¨­å€¼ä¹Ÿè¨­ç‚ºæ¥è¿‘ fitï¼ˆä¸è¦†è“‹ä½¿ç”¨è€…èª¿æ•´ï¼‰
    return fit;
  }

  function updateLabels(){
    speedVal.textContent = daysPerSecond.toFixed(0).padStart(3,' ');
    distVal.textContent  = pxPerAU.toFixed(0).padStart(2,' ');
    sizeVal.textContent  = sizeScale.toFixed(1);
  }

  // === äº’å‹• ===
  canvas.addEventListener('pointerdown', (e)=>{
    if (e.button !== 0) return;
    isDragging = true; dragStartX = e.clientX; dragStartY = e.clientY; dragViewX = viewOffsetX; dragViewY = viewOffsetY; canvas.setPointerCapture(e.pointerId);
  });
  canvas.addEventListener('pointermove', (e)=>{
    const rect = canvas.getBoundingClientRect();
    mouseX = (e.clientX - rect.left) * dpr; // to device px
    mouseY = (e.clientY - rect.top) * dpr;
    if (isDragging){
      const dx = (e.clientX - dragStartX) * dpr;
      const dy = (e.clientY - dragStartY) * dpr;
      viewOffsetX = dragViewX + dx;
      viewOffsetY = dragViewY + dy;
    }
  });
  canvas.addEventListener('pointerup', ()=>{ isDragging = false; });
  canvas.addEventListener('pointercancel', ()=>{ isDragging = false; });

  canvas.addEventListener('wheel', (e)=>{
    // æ»¾è¼ªåªæ§åˆ¶è·é›¢ç¸®æ”¾ï¼ˆpx/AUï¼‰ï¼Œå«æ¸¸æ¨™ä½ç½®ç¸®æ”¾çš„è¦–è¦ºè£œå„Ÿ
    e.preventDefault();
    const delta = -Math.sign(e.deltaY) * 1; // æ¯æ¬¡ 1 å–®ä½
    const oldPx = pxPerAU;
    const newPx = Math.min(120, Math.max(2, oldPx + delta));
    if (newPx !== oldPx){
      // ä»¥æ¸¸æ¨™ç‚ºä¸­å¿ƒçš„ç¸®æ”¾ï¼šèª¿æ•´ viewOffset è®“æ¸¸æ¨™ä¸‹çš„å®‡å®™åº§æ¨™ç¶­æŒåŒä¸€ AU ä½ç½®
      const worldX = (mouseX - centerX - viewOffsetX) / oldPx; // AU
      const worldY = (mouseY - centerY - viewOffsetY) / oldPx; // AU
      pxPerAU = newPx;
      viewOffsetX = mouseX - centerX - worldX * pxPerAU;
      viewOffsetY = mouseY - centerY - worldY * pxPerAU;
      distEl.value = pxPerAU.toFixed(0);
      updateLabels();
    }
  }, {passive:false});

  playPauseBtn.addEventListener('click', ()=>{
    running = !running; playPauseBtn.textContent = running ? 'â¸ æš«åœ' : 'â–¶ï¸ ç¹¼çºŒ';
  });
  resetBtn.addEventListener('click', ()=>{ simDays = 0; viewOffsetX = viewOffsetY = 0; });
  centerSunBtn.addEventListener('click', ()=>{ viewOffsetX = viewOffsetY = 0; });

  speedEl.addEventListener('input', ()=>{ daysPerSecond = parseFloat(speedEl.value); updateLabels();});
  distEl.addEventListener('input', ()=>{ pxPerAU = parseFloat(distEl.value); updateLabels();});
  sizeEl.addEventListener('input', ()=>{ sizeScale = parseFloat(sizeEl.value); updateLabels();});

  includePlutoEl.addEventListener('change', ()=>{
    // èª¿æ•´é è¨­ pxPerAU ä½¿å…¨éƒ¨è¡Œæ˜Ÿéƒ½åœ¨è¦–é‡å…§ï¼ˆé™¤éä½¿ç”¨è€…è‡ªè¨‚ï¼‰
    const fit = fitPxPerAU();
    if (pxPerAU > fit) return; // ä½¿ç”¨è€…å·²ç¶“ç¸®å¤ªè¿‘å°±ä¸è¦†è“‹
    pxPerAU = Math.max(6, Math.min(parseFloat(distEl.value), fit));
    distEl.value = pxPerAU.toFixed(0); updateLabels();
  });

  // === ç¹ªè£½ ===
  function clearWithStars(){
    // å°‡æ˜Ÿé‡é‹ªæ»¿ç•«é¢
    const scaleX = width / starLayer.width;
    const scaleY = height/ starLayer.height;
    ctx.setTransform(scaleX, 0, 0, scaleY, 0, 0);
    ctx.drawImage(starLayer, 0, 0);
    // é‚„åŸå–®ä½åº§æ¨™
    ctx.setTransform(1,0,0,1,0,0);
  }

  function drawSun(){
    const x = centerX + viewOffsetX, y = centerY + viewOffsetY;
    const r = 24 * dpr * Math.max(0.8, Math.min(2.2, sizeScale));
    const g = ctx.createRadialGradient(x - r*0.25, y - r*0.25, r*0.2, x, y, r*1.1);
    g.addColorStop(0,'#fff7b3');
    g.addColorStop(0.5,'#ffd35a');
    g.addColorStop(1,'rgba(255,160,20,0.05)');
    ctx.fillStyle = g; ctx.beginPath(); ctx.arc(x,y,r,0,TWOPI); ctx.fill();
  }

  function planetPixelRadius(radiusRel){
    // ä»¥åœ°çƒç‚º 1ï¼Œæ¡ç”¨ sqrt å£“ç¸®å‹•æ…‹ç¯„åœï¼Œè¦–è¦ºæœ€å°åŠå¾‘ 2px
    const base = 8 * dpr * sizeScale; // åœ°çƒåŸºæº–
    return Math.max(2*dpr, Math.sqrt(radiusRel) * base);
  }

  function drawOrbit(rPx){
    ctx.save();
    ctx.strokeStyle = 'rgba(180,200,255,0.18)';
    ctx.lineWidth = 1 * dpr;
    ctx.beginPath(); ctx.arc(centerX + viewOffsetX, centerY + viewOffsetY, rPx, 0, TWOPI); ctx.stroke();
    ctx.restore();
  }

  function drawPlanet(p, angle){
    const cx = centerX + viewOffsetX; const cy = centerY + viewOffsetY;
    const rOrbit = p.au * pxPerAU;
    const x = cx + Math.cos(angle) * rOrbit;
    const y = cy + Math.sin(angle) * rOrbit;
    const pr = planetPixelRadius(p.radiusRel);

    // é™°å½±ï¼ˆè¡¨ç¾å—å…‰é¢ï¼‰
    const lightX = cx, lightY = cy; // å¤ªé™½ä½ç½®
    const lx = x - lightX, ly = y - lightY;
    const l = Math.hypot(lx, ly) || 1;
    const nx = lx / l, ny = ly / l;

    const grad = ctx.createRadialGradient(x - nx*pr*0.6, y - ny*pr*0.6, pr*0.2, x, y, pr*1.2);
    grad.addColorStop(0, p.color);
    grad.addColorStop(1, '#000');

    ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(x, y, pr, 0, TWOPI); ctx.fill();

    // åœŸæ˜Ÿç’°
    if (p.ring){
      ctx.save();
      ctx.globalAlpha = 0.6; ctx.strokeStyle = 'rgba(210,190,140,0.95)';
      ctx.lineWidth = pr*0.25; // ç’°å¯¬
      ctx.beginPath();
      ctx.ellipse(x, y, pr*1.8, pr*1.1, 0.35, 0, TWOPI);
      ctx.stroke();
      ctx.restore();
    }

    // æ¨™ç±¤
    if (showLabelsEl.checked){
      ctx.save();
      ctx.font = `${Math.max(10, 12*dpr)}px system-ui, -apple-system, 'Noto Sans TC', sans-serif`;
      ctx.textAlign = 'left'; ctx.textBaseline = 'middle';
      ctx.fillStyle = 'rgba(230,240,255,0.9)';
      ctx.strokeStyle = 'rgba(0,0,0,0.45)'; ctx.lineWidth = 3;
      const label = p.name;
      const lx = x + pr + 6*dpr; const ly = y;
      ctx.strokeText(label, lx, ly);
      ctx.fillText(label, lx, ly);
      ctx.restore();
    }

    return {x, y, r: pr};
  }

  // è¨ˆç®—èˆ‡ç¹ªè£½ä¸€å¹€
  function render(now){
    clearWithStars();

    // è»Œé“
    if (showOrbitsEl.checked){
      activePlanets().forEach(p => drawOrbit(p.au * pxPerAU));
    }

    // å¤ªé™½ç½®åº•ç¹ªè£½ï¼ˆè®“å°¾è·¡ä¸è¦†è“‹å¤ªé™½ï¼‰
    drawSun();

    // è¡Œæ˜Ÿ
    const positions = [];
    activePlanets().forEach(p => {
      const angle = (simDays / p.period) * TWOPI; // ç°¡åŒ–ï¼šåœ“å½¢ç­‰é€Ÿ
      positions.push({p, ...drawPlanet(p, angle)});
    });

    // äº’å‹•ï¼šæ»‘é¼ æç¤ºï¼ˆå‘½ä¸­æ¸¬è©¦ï¼‰
    const hit = positions.find(o => {
      const dx = mouseX - o.x, dy = mouseY - o.y; return dx*dx + dy*dy <= (o.r+3*dpr)*(o.r+3*dpr);
    });
    if (hit){
      const au = hit.p.au;
      tooltip.style.display = 'block';
      tooltip.style.left = (Math.round(mouseX/dpr))+'px';
      tooltip.style.top  = (Math.round(mouseY/dpr))+'px';
      tooltip.innerHTML = `${hit.p.name} Â· è·é›¢ï¼š${au.toFixed(3)} AU`;
    } else {
      tooltip.style.display = 'none';
    }

    // è³‡è¨Šæ¢
    const date = new Date(BASE_DATE.getTime() + simDays*24*3600*1000);
    infobar.textContent = `æ¨¡æ“¬æ—¥æœŸï¼š${date.toISOString().slice(0,10)} ï½œ é€Ÿåº¦ï¼š${daysPerSecond.toFixed(0)} å¤©/ç§’`;
  }

  function activePlanets(){
    return PLANETS_ALL.filter(p => includePlutoEl.checked ? true : p.key !== 'pluto');
  }

  // === ä¸»è¿´åœˆ ===
  let last = performance.now();
  function loop(now){
    const dt = Math.max(0, Math.min(0.1, (now - last)/1000)); // é™åˆ¶æœ€å¤§æ­¥é•· 0.1 ç§’ä»¥é¿å…åˆ‡è¦–çª—é€ æˆè·³èº
    last = now;

    if (running){
      simDays += dt * daysPerSecond;
    }

    if (showTrailsEl.checked){
      // å°¾è·¡æ•ˆæœï¼šä»¥åŠé€æ˜é»‘è“‹ä¸€å±¤ä¸¦é‡ç•«æ˜Ÿç©ºï¼ˆç‡Ÿé€ æ®˜å½±ï¼‰
      ctx.fillStyle = 'rgba(0,0,0,0.22)';
      ctx.fillRect(0,0,width,height);
    }
    render(now);
    requestAnimationFrame(loop);
  }

  // === åˆå§‹åŒ– ===
  function init(){
    buildStars();
    resize();
    // åˆå§‹ px/AU ä»¥è¦–çª—è‡ªå‹•é…é©ï¼Œä¸¦åŒæ­¥åˆ° UI
    const fit = Math.round(fitPxPerAU());
    pxPerAU = Math.min(Math.max(parseFloat(distEl.value), 6), fit);
    distEl.value = pxPerAU.toFixed(0);
    updateLabels();
    requestAnimationFrame(loop);
  }

  window.addEventListener('resize', resize);
  init();
})();
</script>
</body>
</html>
